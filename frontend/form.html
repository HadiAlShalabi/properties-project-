<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <title>إضافة عقار جديد</title>
    <style>
      body {
        font-family: sans-serif;
        padding: 20px;
        max-width: 600px;
        margin: auto;
      }
      label {
        display: block;
        margin-top: 10px;
        font-weight: bold;
      }
      input,
      select,
      textarea {
        width: 100%;
        padding: 6px;
        margin-top: 5px;
        box-sizing: border-box;
      }
      textarea {
        resize: vertical;
      }
      button {
        margin-top: 15px;
        padding: 10px;
        background: #16a085;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1rem;
      }
    </style>
  </head>
  <body>
    <h2>إضافة عقار جديد</h2>
    <form id="propertyForm">
      <label
        >العنوان
        <input type="text" id="title" required />
      </label>

      <label
        >نوع العقار
        <select id="type" required>
          <option value="أرض">أرض</option>
          <option value="دبلكس">دبلكس</option>
          <option value="شقق تمليك">شقق تمليك</option>
          <option value="شقق إيجار">شقق إيجار</option>
          <option value="عقود إيجار">عقود إيجار</option>
        </select>
      </label>

      <label
        >المساحة
        <input type="number" id="size" required />
      </label>

      <label for="price">السعر</label>
      <input type="number" id="price" name="price" required />

      <label
        >عدد الشوارع
        <input type="text" id="streets" required />
      </label>

      <label
        >رابط الموقع (Google Maps)
        <input type="url" id="location" required />
      </label>

      <!-- <label
        >رابط QR للتراخيص
        <input type="url" id="qr" required />
      </label> -->

      <label
        >حالة العقار
        <select id="status" required>
          <option value="available">متاح</option>
          <option value="sold">مباع</option>
          <option value="reserved">محجوز</option>
        </select>
      </label>

      <label
        >رخصة فال
        <input type="text" id="license_type" required />
      </label>

      <label
        >رقم الترخيص
        <input type="text" id="license_number" required />
      </label>

      <label
        >رقم السجل
        <input type="text" id="registry_number" required />
      </label>

      <label
        >رقم المعلن  
        <input type="text" id="AdvertiserNumber" required />
      </label>

      <label
        >الوصف
        <textarea id="description" rows="3" required></textarea>
      </label>

      <label
        >رقم الهاتف (مثلاً 0500000000)
        <input type="tel" id="phone" required />
      </label>

      <label
        >رقم الواتساب (مثلاً 0500000000)
        <input type="tel" id="whatsapp" required />
      </label>

      <label
        >روابط صور العقار (يمكن إدخال عدة روابط مفصولة بفاصلة)
        <textarea
          id="images"
          rows="3"
          placeholder="https://example.com/image1.jpg, https://example.com/image2.jpg"
          required
        ></textarea>
      </label>

      <button type="submit">إضافة العقار</button>
    </form>

    <script>
      document
        .getElementById("propertyForm")
        .addEventListener("submit", function (event) {
          event.preventDefault();

          const imagesInput = document.getElementById("images").value;
          const imagesArray = imagesInput
            .split(",")
            .map((url) => url.trim())
            .filter((url) => url.length > 0);

          if (imagesArray.length === 0) {
            alert("يرجى إدخال رابط صورة واحدة على الأقل.");
            return;
          }

          const newProperty = {
            title: document.getElementById("title").value,
            type: document.getElementById("type").value,
            size: document.getElementById("size").value,
            price: document.getElementById("price").value,
            streets: document.getElementById("streets").value, // نص وليس رقم
            location_link: document.getElementById("location").value,
            qr_link: document.getElementById("qr").value,
            status: document.getElementById("status").value,
            images: imagesArray,
            license_type: document.getElementById("license_type").value,
            license_number: document.getElementById("license_number").value,
            registry_number: document.getElementById("registry_number").value,
            description: document.getElementById("description").value,
            phone: document.getElementById("phone").value,
            whatsapp: document.getElementById("whatsapp").value,
          };

          fetch("http://localhost:3000/properties", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(newProperty),
          })
            .then((response) => response.json())
            .then((data) => {
              alert("✅ تم إضافة العقار بنجاح");
              this.reset();
            })
            .catch((error) => {
              console.error("حدث خطأ:", error);
              alert("حدث خطأ أثناء إضافة العقار");
            });
        });
    </script>
  </body>
</html>
